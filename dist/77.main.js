(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[77],{5077:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b}),r(2526),r(1817),r(2165),r(2222),r(1038),r(6992),r(7042),r(8309),r(1539),r(4916),r(9714),r(8783),r(5306),r(3948);var n=r(7294),o=r(9791),c="submit_button",a=function(e){var t=n.useRef(null);n.useEffect((function(){t.current.focus()}));var r=function t(r,n){0==n&&o.Z.setOrderInTransit(e.order.id,r,e.token.jwt).then((function(){t(r,n+1)})).catch((function(e){i(e.msg,n)})),1==n&&o.Z.checkIfOrderIsInTransit(e.order.id,e.token.jwt).then((function(e){console.log("checkIfOrderIsInTransit ",e),e.res?t(r,n+1):(function(e){var t=Date.now();for(console.log("waste time");Date.now()-t<=2e3;);}(),t(r,n))})).catch((function(e){i(e.msg,n)})),2==n&&o.Z.setOrderDelivered(e.order.id,r,e.token.jwt).then((function(){USE_WAREHOUSE_WORKER_LOGIN?t(r,n+1):a()})).catch((function(e){i(e.msg,n)})),3==n&&o.Z.setWhoMakeDelivery(e.wh_user_id,e.order.id,e.token.jwt).then((function(){a()})).catch((function(e){i(e.msg,n,n)}))},a=function(){window.alert("Order delivered succesfully. Good job!"),window.location.reload()},i=function(r,n){alert(r),o.Z.saveProcedure("2",e.deliver_order_proc_name,{order_id:e.order.id,box_n:t.current.value,user:e.wh_user_id,step:n}),window.location.reload()};return n.createElement("form",{id:"print_form",onSubmit:function(e){e.preventDefault(),document.getElementById(c).disable=!0,r(t.current.value,0)}},n.createElement("div",{className:"form-row container-fluid"},n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("input",{type:"number",min:"0",step:"1",className:"form-control",id:"colli",placeholder:"Default 0",ref:t})),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:c,type:"submit",className:"btn btn-primary btn-block"},"Deliver"))))},i="set_box_btn_id",l="undo_btn_id",d=function(e){var t=n.useRef(null);n.useEffect((function(){t.current.focus()}));var r=function(){document.getElementById(i).disable=!0,document.getElementById(l).disable=!0},c=function(t,r,n){alert(t+r+n),o.Z.saveProcedure("2",e.set_boxes_proc_name,{order_id:e.order.id,box_n:n,user:e.wh_user_id,step:r}),window.location.reload()},a="".concat(e.info.order_state," on ").concat(e.info.order_date_change);return"DELIVERED"==e.info.order_state&&(a+=" with ".concat(e.order.box_n," packages")),n.createElement("div",null,n.createElement("p",null,a),n.createElement("form",{id:"print_form",onSubmit:function(n){n.preventDefault(),r();var a=t.current.value,i=0;o.Z.setOrderDelivered(e.order.id,a,e.token.jwt).then((function(r){i++,o.Z.setWhoMakeDelivery(e.wh_user_id,e.order.id,e.token.jwt).then((function(){var r;r="Order ".concat(e.order.id," modified succesfully. Set ").concat(t.current.value," box. Good job!"),alert(r),window.location.reload()})).catch((function(e){console.log("step in catch ",i),c(e.msg,i,a)}))})).catch((function(e){c(e.msg,i,a)}))}},n.createElement("div",{className:"form-row container-fluid"},n.createElement("div",{className:"col-md-6 mt-1"},n.createElement("input",{type:"number",min:"0",step:"1",className:"form-control",id:"colli",placeholder:" Curr boxes ".concat(e.order.box_n," "),ref:t})),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:i,type:"submit",className:"btn btn-primary btn-block"},"Set boxes")),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:l,type:"button",className:"btn btn-danger btn-block",onClick:function(){r(),o.Z.undoDeliver(e.order.id,e.token.jwt).then((function(){var t="Order ".concat(e.order.id," undo succesfully. Good job!");alert(t),window.location.reload()})).catch((function(t){o.Z.saveProcedure("2",e.undo_deliver_proc_name,{order_id:e.order.id}),alert(t.msg),window.location.reload()}))}},"Undo Order")))))};function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,c=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){o=!0,c=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw c}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m="Withdrowal from warehouse ",f="DELIVER_ORDER",v="SET_BOXES",h="UNDO_DELIVER",p="PROCEDURE procedure DONE WITH DATA data",_="CANT DO PROCEDURE procedure WITH DATA data. SAVING";const b={PluginCard:function(e){var t=u(n.useState(""),2),r=t[0],c=t[1],i=u(n.useState(0),2),l=i[0],s=i[1],p=u(n.useState(0),2),_=p[0],b=p[1];return n.useEffect((function(){o.Z.canDeliverOrder_OLD_OLD(e.order.id,e.token.jwt).then((function(e){var t=e.res?2:1;b(t),s(e.box_n),c(e.info)})).catch((function(e){alert(e),window.location.reload()}))}),[]),n.createElement("div",{className:"card"},n.createElement("div",{className:"card-body"},n.createElement("div",{className:"media"},n.createElement("img",{className:"align-self-start mr-3",src:"https://static.life365.eu/common/template-02/images/favicon.ico",alt:"Courier logo"}),n.createElement("div",{className:"media-body"},n.createElement("h5",{className:"mt-0"},m),1==_&&n.createElement(d,{order:e.order,token:e.token,info:r,set_boxes_proc_name:v,undo_deliver_proc_name:h,box_n:l,wh_user_id:e.wh_user_id}),2==_&&n.createElement(a,{order:e.order,token:e.token,wh_user_id:e.wh_user_id,deliver_order_proc_name:f})))))},redoProcedure:function e(t,r,n){console.log("Plugin ".concat(m," procedure: ").concat(t," ").concat(r));var c=r.order_id;console.log("Order id "+c);var a=r.box_n,i=r.user,l=r.step,d=function(e,t){var r=p.replace("procedure",e).replace("data",t);console.log(r)},u=function(e,t,r,n){var c=_.replace("procedure",t).replace("data",r);o.Z.saveProcedure(e,t,r),console.log(c),console.log(n)},s=function(t,r,n){r.step++,e(t,r,n)};o.Z.canDeliverOrder_OLD_OLD(c,n).then((function(e){switch(t){case f:e.res&&0==l&&o.Z.setOrderInTransit(c,a,n).then((function(){s(t,r,n)})).catch((function(e){u("2",t,r,e)})),1==l&&o.Z.setOrderDelivered(c,a,n).then((function(){USE_WAREHOUSE_WORKER_LOGIN?s(t,r,n):d(t,r)})).catch((function(e){u("2",t,r,e)})),2==l&&(console.log("-------------- aggiornamento del log -----------"),o.Z.setWhoMakeDelivery(i,c,n).then((function(){d(t,r)})).catch((function(e){u("2",t,r,e)})));break;case v:e.res||(console.log("---- step : ",l," procedure name ",t),0==l?o.Z.setOrderDelivered(c,a,n).then((function(){s(t,r,n)})).catch((function(e){u("2",t,r,e)})):1==l&&o.Z.setWhoMakeDelivery(i,c,n).then((function(){d(t,r)})).catch((function(e){u("2",t,r,e)})));break;case h:e.res||o.Z.undoDeliver(c,n).then((function(){var e=p.replace("procedure",t).replace("data",r);console.log(e)})).catch((function(e){var n=_.replace("procedure",t).replace("data",r);o.Z.saveProcedure("2",t,r),console.log(n),console.log(e)}));break;default:console.log("PROCEDURE UNKNOW")}})).catch((function(e){var n=_.replace("procedure",t).replace("data",r);o.Z.saveProcedure("2",t,r),console.log(n),console.log(e)}))}}}}]);