<<<<<<< HEAD
(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[81],{8081:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v}),r(2526),r(1817),r(2165),r(9554),r(1038),r(6992),r(7042),r(8309),r(1539),r(9714),r(8783),r(4747),r(3948);var n=r(7294),o=r(9791),a=r(4648);function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(2222),r(8674),r(4916),r(5306),r(2772),r(4986),r(7941),r(4603),r(4723);var i=function(){function e(t,r,n,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canAddAnotherStep=!1,this.steps=[],this.currentStep=0,this.app_id=t,this.procedure_name=r,null==n&&(n={}),this.options={saveProcedure:null==n.saveProcedure||n.saveProcedure,redo_from_beginning:null==n.redo_from_beginning||n.redo_from_beginning},this.procedureEndCallback=null!=o?o:function(){},this.procedureNotWorkCallback=null!=a?a:function(){}}var t,r;return t=e,(r=[{key:"addProcedureSteps",value:function(e){this.steps=e}},{key:"execute",value:function(){this.steps.length-this.currentStep>0?this.steps[this.currentStep].isAsync?this.doAnotherAsyncStep():this.doAnotherSyncStep():this.procedureEndCallback(this)}},{key:"doAnotherSyncStep",value:function(){try{(0,this.steps[this.currentStep].f)(this.steps[this.currentStep].params),this.currentStep++,this.execute()}catch(e){this.options.saveProcedure&&this.saveProcedure(),this.procedureNotWorkCallback(this,e)}}},{key:"doAnotherAsyncStep",value:function(){var e=this,t=this.steps[this.currentStep].f,r=this.steps[this.currentStep].params,n=this.steps[this.currentStep].redo,o=null!=n?this.steps[this.currentStep].redo.time:void 0,a=null!=n?this.steps[this.currentStep].redo.timeout:void 0;t(r).then((function(t){e.currentStep++,e.execute()})).catch((function(t){null!=n&&o>0?setTimeout((function(){console.log("time ",o),e.steps[e.currentStep].redo.time--,e.doAnotherAsyncStep()}),a):(e.options.saveProcedure&&e.saveProcedure(),console.log("steps inside",e.currentStep),e.procedureNotWorkCallback(e,t))}))}},{key:"saveProcedure",value:function(){var e=this,t=Date.now(),r="".concat(this.app_id,"_").concat(this.procedure_name,"_").concat(t);console.log("Saving procedure",r);var n=[],o=this.options.redo_from_beginning,a=0;this.steps.forEach((function(t){if(o||a>=e.currentStep){var r=t.f.toString(),c={f:r.slice(r.indexOf("{")+1,r.lastIndexOf("}")),params:t.params,isAsync:t.isAsync};n.push(c)}a++}));var c=JSON.stringify({app_id:this.app_id,proc_name:this.procedure_name,steps:n});window.localStorage.setItem(r,c)}}])&&c(t.prototype,r),e}(),s={account:{userID:1020103,password:"brt1452st"},createData:{network:"",departureDepot:131,senderCustomerCode:1020103,deliveryFreightTypeCode:"DAP",consigneeCompanyName:"Life365 Italy",consigneeAddress:"fgfgfhf",consigneeZIPCode:"47121",consigneeCity:"Forli",consigneeCountryAbbreviationISOAlpha2:"IT",cashOnDelivery:0,isCODMandatory:"0",codPaymentType:"",codCurrency:"EUR",numericSenderReference:448,numberOfParcels:20,weightKG:1},isLabelRequired:1,labelParameters:{outputType:"PDF",offsetX:0,offsetY:0,isBorderRequired:"N",isLogoRequired:"N",isBarcodeControlRowRequired:"N"}},d={account:{userID:1020103,password:"brt1452st"},deleteData:{senderCustomerCode:1020103,numericSenderReference:-1}};function l(){return JSON.stringify(s)}var u="submit_button",p="ERROR IN BRT COMMUNICATION: ",f="ERROR_PRINTING: ",m="The request will be saved and done as soon as possible",_={code:1,msg:"System error. "+m},h={code:2,msg:"App cannot contact the system. Check yuor connection! "+m},E=function(e){var t=n.useRef(null);n.useEffect((function(){t.current.focus()}));var r=function(){window.alert("Order delivered succesfully. Good job!"),window.location.reload()},o=function(e){alert(e),window.location.reload()};return n.createElement("form",{id:"print_form",onSubmit:function(n){n.preventDefault();var a,c=null!=(a=window.localStorage.getItem("numericSenderReference"))?(a=parseInt(a),a+=1,window.localStorage.setItem("numericSenderReference",a),a):(window.localStorage.setItem("numericSenderReference",13),13);console.log("label function"),document.getElementById(u).disable=!0,console.log("---- GET BODY ---"),console.log(JSON.parse(l()));var s=JSON.parse(l());console.log(e.order),s.createData.departureDepot=e.order.departureDepot,s.createData.consigneeCompanyName=e.order.sender,s.createData.consigneeAddress=e.order.address,s.createData.consigneeZIPCode=e.order.zipCode,s.createData.consigneeCity=e.order.city,e.order.isCODMandatory&&(s.createData.cashOnDelivery=e.order.total,s.createData.IsCODMandatory="1",s.createData.codPaymentType=e.order.isCheck?"OM":""),s.createData.numericSenderReference=c,s.createData.weightKG=e.order.weight,s.createData.numberOfParcels=t.current.value,console.log("----- PARCEL ID -----"),console.log(e.order.id);var d=new i("courier_1",e.label_order_proc_name+"_API_and_print",{saveProcedure:!1},(function(){!function(n){console.log("---- Procedura di aggiornamento dei nostri sistemi ----");var a=e.order.shipment_data;a.numericSenderReference=[n];var c=new i("courier_1",e.label_order_proc_name+"_UPDATE_OUR_SYSTEM",{redo_from_the_beginnign:!1},r,(function(e,t){o("ERROR IN UPDATE OUR SYSTEM (don't worry we do this automatically")})),s=[{f:function(e){return new Promise((function(t,r){var n={logistic_state:"LABELLED",box_n:e.box_n,shipment_data:e.shipment_data},o=e.DEBUG&&null!=e.DEBUG?"".concat(e.setOrderLabelURL.replace("-1",e.order_id),"/debug?jwt=").concat(e.jwt):"".concat(e.setOrderLabelURL.replace("-1",e.order_id),"?jwt=").concat(e.jwt),a={"Content-Type":"application/json"};new Promise((function(t,r){fetch(o,{method:"PUT",headers:a,body:JSON.stringify(n)}).then((function(n){n.ok?(console.log("--- Setted Order Labelled ---"),t()):r(e.SYSTEM_ERROR)})).catch((function(){r(e.REQUEST_ERROR)}))})).then((function(e){return t()})).catch((function(e){return r(e)}))}))},params:{order_id:e.order.id,box_n:t.current.value,jwt:e.token.jwt,setOrderLabelURL:ORDER_EDIT,shipment_data:a,SYSTEM_ERROR:_,REQUEST_ERROR:h,DEBUG:!1},isAsync:!0,redo:{time:3,timeout:200}}];USE_WAREHOUSE_WORKER_LOGIN&&s.push({f:function(e){return new Promise((function(t,r){var n=e.DEBUG?"".concat(e.SET_WHO_MAKE_THE_DELIVERY,"/debug?jwt=").concat(e.jwt):"".concat(e.SET_WHO_MAKE_THE_DELIVERY,"?jwt=").concat(e.jwt),o={"Content-Type":"application/json"},a={user:e.wh_user_id,order_id:e.order_id};return new Promise((function(t,r){fetch(n,{method:"POST",headers:o,body:JSON.stringify(a)}).then((function(n){n.ok?(console.log("---- Set who make deliver ---"),t()):r(e.SYSTEM_ERROR)})).catch((function(){r(e.REQUEST_ERROR)}))})).then((function(e){return t()})).catch((function(e){return r(e)}))}))},params:{wh_user_id:e.wh_user_id,set_who_make_delivery:SET_WHO_MAKE_THE_DELIVERY,order_id:e.order.id,jwt:e.token.jwt,SET_WHO_MAKE_THE_DELIVERY,SYSTEM_ERROR:_,REQUEST_ERROR:h,DEBUG:!1},isAsync:!0,redo:{time:3,timeout:200}}),c.addProcedureSteps(s),c.execute()}(c)}),(function(e,t){console.log("step",e.currentStep),0==e.currentStep?o(p+" "+t):o(f+" "+t)}));d.addProcedureSteps([{f:function(e){return new Promise((function(t,r){console.log("BRT FUNCTION ---",e.orderId),console.log(e.body),fetch("https://api.brt.it/rest/v1/shipments/shipment",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"https://api.brt.it","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS"},body:JSON.stringify(e.body)}).then((function(n){n.ok&&n.json().then((function(n){console.log("BRT res"),console.log(n),fetch("http://localhost:5001/label_writer_450/printPDF",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:n.createResponse.labels.label,orderId:e.orderId})}).then((function(e){console.log("Risposta delletichettatrice"),console.log(e),e.ok?(t(),console.log(e)):r(f)})).catch((function(e){return r(f+" "+e)}))})).catch((function(e){r(f+" "+e)}))})).catch((function(e){r(p+" can t contact the system")}))}))},params:{body:s,orderId:e.order.id,REDO_BRT_API_CALL:3},isAsync:!0}]),d.execute()}},n.createElement("div",{className:"form-row container-fluid"},n.createElement("div",{className:"col-md-5 mt-1"},n.createElement("input",{type:"number",min:"0",step:"1",className:"form-control",id:"colli",placeholder:"Default 0",ref:t})),n.createElement("div",{className:"col-md-5 mt-1"},n.createElement("button",{id:u,type:"submit",className:"btn btn-primary btn-block"},"Print label"))))},R="ERROR IN BRT COMMUNICATION: ",S="The request will be saved and done as soon as possible",y={code:1,msg:"System error. "+S},b={code:2,msg:"App cannot contact the system. Check yuor connection! "+S},g="CAN'T REPRINT THE LABEL... How manty time ago you prepare this order?",O=function(e){var t=n.useRef(null),r=n.useRef(null);n.useEffect((function(){r.current.value=e.order.box_n,t.current.focus()}));var a=function(e){alert(e),window.location.reload()},c=function(t,r,n){alert(t+r+n),o.Z.saveProcedure("2",e.add_boxes_proc_name,{order_id:e.order.id,box_n:n,user:e.wh_user_id,step:r}),window.location.reload()};function s(n,o){console.log("---- Procedura di aggiornamento dei nostri sistemi ----");var s=e.order.shipment_data;s.numericSenderReference=n;var d=new i("courier_1",e.label_order_proc_name+"_UPDATE_OUR_SYSTEM",{redo_from_the_beginnign:!1},(function(){a(" Boxes added succesfully")}),(function(e,t){c("ERROR IN UPDATE OUR SYSTEM (don't worry we do this automatically")})),l=[{f:function(e){return new Promise((function(t,r){var n={box_n:e.box_n,shipment_data:e.shipment_data,logistic_state:e.logistic_state},o=e.DEBUG&&null!=e.DEBUG?"".concat(e.orderEdit.replace("-1",e.order_id),"/debug?jwt=").concat(e.jwt):"".concat(e.orderEdit.replace("-1",e.order_id),"?jwt=").concat(e.jwt),a={"Content-Type":"application/json"};new Promise((function(t,r){fetch(o,{method:"PUT",headers:a,body:JSON.stringify(n)}).then((function(n){n.ok?(console.log("--- Setted order",e.logistic_state," ---"),t()):r(e.SYSTEM_ERROR)})).catch((function(){r(e.REQUEST_ERROR)}))})).then((function(e){return t()})).catch((function(e){return r(e)}))}))},params:{order_id:e.order.id,box_n:parseInt(r.current.value)+parseInt(t.current.value),jwt:e.token.jwt,orderEdit:ORDER_EDIT,shipment_data:s,logistic_state:o,SYSTEM_ERROR:y,REQUEST_ERROR:b,DEBUG:!1},isAsync:!0,redo:{time:3,timeout:200}}];USE_WAREHOUSE_WORKER_LOGIN&&l.push({f:function(e){return new Promise((function(t,r){var n=e.DEBUG?"".concat(e.SET_WHO_MAKE_THE_DELIVERY,"/debug?jwt=").concat(e.jwt):"".concat(e.SET_WHO_MAKE_THE_DELIVERY,"?jwt=").concat(e.jwt),o={"Content-Type":"application/json"},a={user:e.wh_user_id,order_id:e.order_id};return new Promise((function(t,r){fetch(n,{method:"POST",headers:o,body:JSON.stringify(a)}).then((function(n){n.ok?(console.log("---- Setted who make deliver ---"),t()):r(e.SYSTEM_ERROR)})).catch((function(){r(e.REQUEST_ERROR)}))})).then((function(e){return t()})).catch((function(e){return r(e)}))}))},params:{wh_user_id:e.wh_user_id,set_who_make_delivery:SET_WHO_MAKE_THE_DELIVERY,order_id:e.order.id,jwt:e.token.jwt,SET_WHO_MAKE_THE_DELIVERY,SYSTEM_ERROR:y,REQUEST_ERROR:b,DEBUG:!1},isAsync:!0,redo:{time:3,timeout:200}}),d.addProcedureSteps(l),d.execute()}var u="".concat(e.info.order_state," on ").concat(e.info.order_date_change);return"DELIVERED"==e.info.order_state&&(u+=" with ".concat(e.order.box_n," packages")),n.createElement("div",null,n.createElement("p",null,u),n.createElement("form",{id:"print_form"},n.createElement("div",{className:"form-row container-fluid"},n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("input",{type:"number",min:"0",style:{height:"100%"},step:"1",className:"form-control",id:"colli",placeholder:" Curr boxes ".concat(e.order.box_n," "),ref:r,disabled:!0})),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("input",{type:"number",min:"0",style:{height:"100%"},step:"1",className:"form-control",id:"colli",placeholder:" Box to add ",ref:t})),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:"add_box_btn_id",type:"submit",className:"btn btn-primary btn-block",onClick:function(r){r.preventDefault(),fetch(GET_NUMERIC_SENDER_REFERENCE).then((function(r){r.ok?r.json().then((function(r){var n=JSON.parse(l());n.createData.departureDepot=e.order.departureDepot,n.createData.consigneeCompanyName=e.order.sender,n.createData.consigneeAddress=e.order.address,n.createData.consigneeZIPCode=e.order.zipCode,n.createData.consigneeCity=e.order.city,e.order.isCODMandatory&&(n.createData.cashOnDelivery=e.order.total,n.createData.IsCODMandatory="1",n.createData.codPaymentType=e.order.isCheck?"OM":""),n.createData.numericSenderReference=r.numericSenderReference,n.createData.weightKG=e.order.weight,n.createData.numberOfParcels=t.current.value;var o=new i("courier_1",e.label_order_proc_name+"_API_and_print",{saveProcedure:!1},(function(){var t=e.order.shipment_data.numericSenderReference;t.push(r.numericSenderReference),s(t,e.order.logistic_state)}),(function(e,t){0==e.currentStep?c(R+" "+t):c("ERROR_PRINTING:  "+t)}));o.addProcedureSteps([{f:function(t){return new Promise((function(r,n){fetch("https://api.brt.it/rest/v1/shipments/shipment",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"https://api.brt.it","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS"},body:JSON.stringify(t.body)}).then((function(o){o.ok&&o.json().then((function(o){fetch("http://localhost:5001/label_writer_450/printPDF",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({label:o.createResponse.labels.label,startingBox:e.order.box_n,orderId:t.orderId})}).then((function(e){e.ok?r():n("ERROR_PRINTING: ")})).catch((function(e){return n("ERROR_PRINTING:  "+e)}))})).catch((function(e){n("ERROR_PRINTING:  "+e)}))})).catch((function(e){n(R+" can t contact the system")}))}))},params:{body:n,orderId:e.order.id,REDO_BRT_API_CALL:3},isAsync:!0}]),o.execute()})):alert("ERROR IN GET REFERENCE NUMBER PLEASE CONTACT THE ASSISTANT")})).catch((function(e){alert("ERROR IN GET REFERENCE NUMBER PLEASE CONTACT THE ASSISTANT")}))}},"Add boxes")),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:"reprint_btn_id",type:"submit",className:"btn btn-primary btn-block",onClick:function(t){t.preventDefault(),fetch("http://localhost:5001/label_writer_450/reprintPDF",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e.order.id})}).then((function(e){e.ok?a("REPRINT CORRECTLY"):alert(g)})).catch((function(){alert(g)}))}},"Reprint labels")),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:"undo_btn_id",type:"button",className:"btn btn-danger btn-block",onClick:function(t){t.preventDefault();var r=JSON.parse(JSON.stringify(d));e.order.shipment_data.numericSenderReference.forEach((function(t){r.deleteData.numericSenderReference=t;var n=new i("courier_1",e.undo_label_proc_name,{saveProcedure:!1},(function(){}),(function(e,t){c(R+" "+t)}));n.addProcedureSteps([{f:function(e){return new Promise((function(t,r){console.log("--- BRT API DELETE ---"),fetch("https://api.brt.it/rest/v1/shipments/delete",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e.body)}).then((function(e){e.ok&&e.json().then((function(e){t()})).catch((function(e){r(e)}))})).catch((function(e){r(R+" can t contact the system")}))}))},params:{body:r,orderId:e.order.id},isAsync:!0}]),n.execute()})),s([],"PICKED")}},"Undo Order")))))};function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var c,i=e[Symbol.iterator]();!(n=(c=i.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}const v={PluginCard:function(e){var t=T(n.useState(""),2),r=t[0],c=t[1],i=T(n.useState(0),2),s=i[0],d=i[1],l=T(n.useState(0),2),u=l[0],p=l[1];return n.useEffect((function(){o.Z.canLabelOrder(e.order.id,e.token.jwt).then((function(e){var t=e.res?2:1;console.log("---- stato plugin ",t,"----"),p(t),d(e.box_n),c(e.info)})).catch((function(e){alert(e),window.location.reload()}))}),[]),n.createElement("div",{className:"card"},n.createElement("div",{className:"card-body"},n.createElement("div",{className:"media"},n.createElement("img",{className:"align-self-start mr-3",src:"https://static.life365.eu/common/template-02/images/courier/logo_brt.jpg",alt:"Courier logo"}),n.createElement("div",{className:"media-body"},n.createElement("h5",{className:"mt-0"},"BRT"),1==u&&n.createElement(O,{order:a.Z.parseOrder(e.order),token:e.token,info:r,set_boxes_proc_name:"SET_BOXES",undo_label_proc_name:"UNDO_LABEL",box_n:s,wh_user_id:e.wh_user_id}),2==u&&n.createElement(E,{order:a.Z.parseOrder(e.order),token:e.token,wh_user_id:e.wh_user_id,label_order_proc_name:"LABEL_ORDER"})))))},redoProcedure:function(e){for(var t,r,n,o=("courier_1",t=Object.keys(window.localStorage),r=[],n=new RegExp("courier_1"),t.forEach((function(e){if(null!=e.match(n)){var t=window.localStorage.getItem(e),o=JSON.parse(t);o.steps.forEach((function(e){e.f=new Function("params",e.f)})),r.push(o),window.localStorage.removeItem(e)}})),r),a=0;a<o.length;a++){var c=o[a],s=new i(c.app_id,c.proc_name,{redo_from_beginning:!0,saveProcedure:!0},(function(){console.log("FATTOOOOO")}),(function(){console.log("un sacco di errori")}));c.steps.forEach((function(t){console.log("reset jwt in params"),t.params.jwt=e,t.params.DEBUG=!1})),s.addProcedureSteps(c.steps),s.execute()}}}},6583:(e,t,r)=>{"use strict";var n=r(5656),o=r(9958),a=r(7466),c=r(9341),i=r(9207),s=Math.min,d=[].lastIndexOf,l=!!d&&1/[1].lastIndexOf(1,-0)<0,u=c("lastIndexOf"),p=i("indexOf",{ACCESSORS:!0,1:0}),f=l||!u||!p;e.exports=f?function(e){if(l)return d.apply(this,arguments)||0;var t=n(this),r=a(t.length),c=r-1;for(arguments.length>1&&(c=s(c,o(arguments[1]))),c<0&&(c=r+c);c>=0;c--)if(c in t&&t[c]===e)return c||0;return-1}:d},9587:(e,t,r)=>{var n=r(111),o=r(7674);e.exports=function(e,t,r){var a,c;return o&&"function"==typeof(a=t.constructor)&&a!==r&&n(c=a.prototype)&&c!==r.prototype&&o(e,c),e}},2772:(e,t,r)=>{"use strict";var n=r(2109),o=r(1318).indexOf,a=r(9341),c=r(9207),i=[].indexOf,s=!!i&&1/[1].indexOf(1,-0)<0,d=a("indexOf"),l=c("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:s||!d||!l},{indexOf:function(e){return s?i.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},4986:(e,t,r)=>{var n=r(2109),o=r(6583);n({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},4603:(e,t,r)=>{var n=r(9781),o=r(7854),a=r(4705),c=r(9587),i=r(3070).f,s=r(8006).f,d=r(7850),l=r(7066),u=r(2999),p=r(1320),f=r(7293),m=r(9909).set,_=r(6340),h=r(5112)("match"),E=o.RegExp,R=E.prototype,S=/a/g,y=/a/g,b=new E(S)!==S,g=u.UNSUPPORTED_Y;if(n&&a("RegExp",!b||g||f((function(){return y[h]=!1,E(S)!=S||E(y)==y||"/a/i"!=E(S,"i")})))){for(var O=function(e,t){var r,n=this instanceof O,o=d(e),a=void 0===t;if(!n&&o&&e.constructor===O&&a)return e;b?o&&!a&&(e=e.source):e instanceof O&&(a&&(t=l.call(e)),e=e.source),g&&(r=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var i=c(b?new E(e,t):E(e,t),n?this:R,O);return g&&r&&m(i,{sticky:r}),i},T=function(e){e in O||i(O,e,{configurable:!0,get:function(){return E[e]},set:function(t){E[e]=t}})},w=s(E),v=0;w.length>v;)T(w[v++]);R.constructor=O,O.prototype=R,p(o,"RegExp",O)}_("RegExp")}}]);
=======
(self.webpackChunktemplate=self.webpackChunktemplate||[]).push([[81],{8081:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E}),r(2526),r(1817),r(2165),r(2222),r(1038),r(6992),r(7042),r(8309),r(1539),r(4916),r(9714),r(8783),r(5306),r(3948);var n=r(7294),o=r(9791);function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r(9554),r(8674),r(4747),r(2772),r(4986),r(7941),r(4603),r(4723);var c=function(){function e(t,r,n,o,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.canAddAnotherStep=!1,this.steps=[],this.currentStep=0,this.app_id=t,this.procedure_name=r,null==n&&(n={}),this.options={saveProcedure:null==n.saveProcedure||n.saveProcedure,redo_from_beginning:null==n.redo_from_beginning||n.redo_from_beginning},this.procedureEndCallback=null!=o?o:function(){},this.procedureNotWorkCallback=null!=a?a:function(){}}var t,r;return t=e,(r=[{key:"addProcedureSteps",value:function(e){this.steps=e}},{key:"execute",value:function(){this.steps.length-this.currentStep>0?this.steps[this.currentStep].isAsync?this.doAnotherAsyncStep():this.doAnotherSyncStep():this.procedureEndCallback(this)}},{key:"doAnotherSyncStep",value:function(){try{(0,this.steps[this.currentStep].f)(this.steps[this.currentStep].params),this.currentStep++,this.execute()}catch(e){this.options.saveProcedure&&this.saveProcedure(),this.procedureNotWorkCallback(this,e)}}},{key:"doAnotherAsyncStep",value:function(){var e=this,t=this.steps[this.currentStep].f,r=this.steps[this.currentStep].params,n=this.steps[this.currentStep].redo,o=null!=n?this.steps[this.currentStep].redo.time:void 0,a=null!=n?this.steps[this.currentStep].redo.timeout:void 0;t(r).then((function(t){e.currentStep++,e.execute()})).catch((function(t){null!=n&&o>0?setTimeout((function(){console.log("time ",o),e.steps[e.currentStep].redo.time--,e.doAnotherAsyncStep()}),a):(e.options.saveProcedure&&e.saveProcedure(),console.log("steps inside",e.currentStep),e.procedureNotWorkCallback(e,t))}))}},{key:"saveProcedure",value:function(){var e=this,t=Date.now(),r="".concat(this.app_id,"_").concat(this.procedure_name,"_").concat(t);console.log("Saving procedure",r);var n=[],o=this.options.redo_from_beginning,a=0;this.steps.forEach((function(t){if(o||a>=e.currentStep){var r=t.f.toString(),c={f:r.slice(r.indexOf("{")+1,r.lastIndexOf("}")),params:t.params,isAsync:t.isAsync};n.push(c)}a++}));var c=JSON.stringify({app_id:this.app_id,proc_name:this.procedure_name,steps:n});window.localStorage.setItem(r,c)}}])&&a(t.prototype,r),e}(),i={account:{userID:1020103,password:"brt1452st"},createData:{network:"",departureDepot:102,senderCustomerCode:1020103,deliveryFreightTypeCode:"DAP",consigneeCompanyName:"Life365 Italy",consigneeAddress:"",consigneeZIPCode:"",consigneeCity:"",consigneeCountryAbbreviationISOAlpha2:"IT",cashOnDelivery:0,isCODMandatory:"0",codPaymentType:"",codCurrency:"EUR",numericSenderReference:0,numberOfParcels:0,weightKG:0},isLabelRequired:1,labelParameters:{outputType:"PDF",offsetX:0,offsetY:0,isBorderRequired:"N",isLogoRequired:"N",isBarcodeControlRowRequired:"N"}},s="submit_button",l="ERROR IN BRT COMMUNICATION: ",d="ERROR_PRINTING: ",u=function(e){var t=n.useRef(null);n.useRef(null),n.useEffect((function(){t.current.focus()}));var r=function(e){alert(e),window.location.reload()};return n.createElement("form",{id:"print_form",onSubmit:function(n){n.preventDefault(),console.log("label function"),document.getElementById(s).disable=!0;var a,u=JSON.parse(JSON.stringify(i));u.createData.departureDepot=e.order.departureDepot,u.createData.consigneeCompanyName=e.order.sender,u.createData.consigneeAddress=e.order.address,u.createData.consigneeZipCode=e.order.zipCode,u.createData.consigneeCity=e.order.city,u.createData.consigneeCountryAbbreviationISOAlpha2=e.order.consigneeCountryAbbreviationISOAlpha2,u.createData.cashOnDelivery=e.order.total,u.createData.isCodeMandatory=e.order.isCODMandatory?"1":"0",u.createData.codPaymentType=e.order.isCheck?"OM":"",u.createData.numericSenderReference=null!=(a=window.localStorage.getItem("numericSenderReference"))?(a=parseInt(a),a+=1,window.localStorage.setItem("numericSenderReference",a),a):(window.localStorage.setItem("numericSenderReference",13),13),u.createData.weightKG=e.order.weight,u.createData.numberOfParcels=t.current.value,console.log("----- CREATE BODY -----"),console.log(u);var p=new c("courier_2",e.label_order_proc_name+"_API_and_print",{saveProcedure:!1},(function(){}),(function(e,t){console.log("step",e.currentStep),0==e.currentStep?r(l+" "+t):r(d+" "+t)}));p.addProcedureSteps([{f:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return new Promise((function(t,r){console.log("BRT FUNCTION"),console.log(e.body),fetch("https://api.brt.it/rest/v1/shipments/shipment",{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"https://api.brt.it","Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS"},body:JSON.stringify(e.body)}).then((function(n){n.ok?n.json().then((function(e){console.log("BRT res"),console.log(e),e.createResponse.labels.label.forEach((function(e){console.log("parcelID"+e.parcelID);var t=e.stream;window.open(e.parcelID).document.write("<iframe width='100%' height='100%' src='data:application/pdf;base64, "+encodeURI(t)+"'></iframe>"),console.log("---- Stampa etichetta con stampante ---")})),t()})).catch((function(e){r(d)})):e.REDO_BRT_API_CALL>0?(e.REDO_BRT_API_CALL=e.REDO_BRT_API_CALL-1,f(e)):r(l+" cannot parse data recived")})).catch((function(t){e.REDO_BRT_API_CALL>0?(e.REDO_BRT_API_CALL=e.REDO_BRT_API_CALL-1,f(e)):r(l+" can t contact the system")}))}))})),params:{body:u,REDO_BRT_API_CALL:3},isAsync:!0},{f:function(t){console.log("---- Procedura di aggiornamento dei nostri sistemi ----");var r=new c("courier_2",e.label_order_proc_name+"life365_system",{redo_from_the_beginnign:!0}),n=[{f:function(e){return new Promise((function(t,r){console.log("---- Set order IN TRANSIT ---"),o.Z.setOrderInTransit(e.order_id,e.box_n,e.jwt).then((function(e){console.log("--- SET ORDER IN TRANSIT OK ---"),t()})).catch((function(e){console.log(e),r(e)}))}))},params:t.sub_proc_params,isAsync:!0}];SET_WHO_MAKE_THE_DELIVERY&&n.push({f:function(e){return new Promise((function(t,r){console.log("---- Set who make deliver ---"),o.Z.setWhoMakeDelivery(e.wh_user_id,e.order_id,e.jwt).then((function(e){console.log("--- SET WHO MAKE DELIVER  OK ---"),t()})).catch((function(e){console.log(e),r(e)}))}))},params:t.sub_proc_params,isAsync:!0}),r.addProcedureSteps(n),r.execute()},params:{sub_proc_params:{order_id:e.order.id,box_n:t.current.value,jwt:e.token.jwt,wh_user_id:e.wh_user_id}},isAsync:!0}]),p.execute()}},n.createElement("div",{className:"form-row container-fluid"},n.createElement("div",{className:"col-md-5 mt-1"},n.createElement("input",{type:"number",min:"0",step:"1",className:"form-control",id:"colli",placeholder:"Default 0",ref:t})),n.createElement("div",{className:"col-md-5 mt-1"},n.createElement("button",{id:s,type:"submit",className:"btn btn-primary btn-block"},"Print label"))))},p="add_box_btn_id",m="undo_btn_id",h=function(e){var t=n.useRef(null);n.useEffect((function(){t.current.focus()}));var r=function(){document.getElementById(p).disable=!0,document.getElementById(m).disable=!0},a=function(t,r,n){alert(t+r+n),o.Z.saveProcedure("2",e.add_boxes_proc_name,{order_id:e.order.id,box_n:n,user:e.wh_user_id,step:r}),window.location.reload()},c="".concat(e.info.order_state," on ").concat(e.info.order_date_change);return"DELIVERED"==e.info.order_state&&(c+=" with ".concat(e.order.box_n," packages")),n.createElement("div",null,n.createElement("p",null,c),n.createElement("form",{id:"print_form",onSubmit:function(n){n.preventDefault(),r();var c=t.current.value,i=0;o.Z.setOrderDelivered(e.order.id,c,e.token.jwt).then((function(t){i++,o.Z.setWhoMakeDelivery(e.wh_user_id,e.order.id,e.token.jwt).then((function(){var t;t="Order ".concat(e.order.id," modified succesfully. Add ").concat(nBoxToSet.current.value," box. Good job!"),alert(t),window.location.reload()})).catch((function(e){console.log("step in catch ",i),a(e.msg,i,c)}))})).catch((function(e){a(e.msg,i,c)}))}},n.createElement("div",{className:"form-row container-fluid"},n.createElement("div",{className:"col-md-4 mt-1"},n.createElement("input",{type:"number",min:"0",style:{height:"100%"},step:"1",className:"form-control",id:"colli",placeholder:" Curr boxes ".concat(e.order.box_n," "),ref:t})),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:p,type:"submit",className:"btn btn-primary btn-block"},"Add boxes")),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:"reprint_btn_id",type:"submit",className:"btn btn-primary btn-block"},"Reprint labels")),n.createElement("div",{className:"col-md-2 mt-1"},n.createElement("button",{id:m,type:"button",className:"btn btn-danger btn-block",onClick:function(){r(),o.Z.undoDeliver(e.order.id,e.token.jwt).then((function(){var t="Order ".concat(e.order.id," undo succesfully. Good job!");alert(t),window.location.reload()})).catch((function(t){o.Z.saveProcedure("2",e.undo_deliver_proc_name,{order_id:e.order.id}),alert(t.msg),window.location.reload()}))}},"Undo Order")))))};function _(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,o=!1,a=void 0;try{for(var c,i=e[Symbol.iterator]();!(n=(c=i.next()).done)&&(r.push(c.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw a}}return r}}(e,t)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var b="SET_BOXES",v="PROCEDURE procedure DONE WITH DATA data",y="CANT DO PROCEDURE procedure WITH DATA data. SAVING";const E={PluginCard:function(e){var t=_(n.useState(""),2),r=t[0],a=t[1],c=_(n.useState(0),2),i=c[0],s=c[1],l=_(n.useState(0),2),d=l[0],p=l[1];return n.useEffect((function(){o.Z.canLabelOrder(e.order.id,e.token.jwt).then((function(e){var t=e.res?2:1;p(t),s(e.box_n),a(e.info)})).catch((function(e){alert(e),window.location.reload()}))}),[]),n.createElement("div",{className:"card"},n.createElement("div",{className:"card-body"},n.createElement("div",{className:"media"},n.createElement("img",{className:"align-self-start mr-3",src:"https://static.life365.eu/common/template-02/images/courier/logo_brt.jpg",alt:"Courier logo"}),n.createElement("div",{className:"media-body"},n.createElement("h5",{className:"mt-0"},"BRT"),1==d&&n.createElement(h,{order:e.order,token:e.token,info:r,set_boxes_proc_name:b,undo_label_proc_name:"UNDO_LABEL",box_n:i,wh_user_id:e.wh_user_id}),2==d&&n.createElement(u,{order:e.order,token:e.token,wh_user_id:e.wh_user_id,label_order_proc_name:"LABEL_ORDER"})))))},redoProcedure:function e(t,r,n){console.log("Plugin ".concat("BRT"," procedure: ").concat(t," ").concat(r));var a=r.order_id;console.log("Order id "+a);var c=r.box_n,i=r.user,s=r.step,l=function(e,t){var r=v.replace("procedure",e).replace("data",t);console.log(r)},d=function(e,t,r,n){var a=y.replace("procedure",t).replace("data",r);o.Z.saveProcedure(e,t,r),console.log(a),console.log(n)},u=function(t,r,n){r.step++,e(t,r,n)};o.Z.canLabelOrder(a,n).then((function(e){switch(t){case DELIVER_ORDER_PROC_NAME:e.res&&0==s&&o.Z.setOrderInTransit(a,c,n).then((function(){u(t,r,n)})).catch((function(e){d("2",t,r,e)})),1==s&&o.Z.setOrderDelivered(a,c,n).then((function(){USE_WAREHOUSE_WORKER_LOGIN?u(t,r,n):l(t,r)})).catch((function(e){d("2",t,r,e)})),2==s&&(console.log("-------------- aggiornamento del log -----------"),o.Z.setWhoMakeDelivery(i,a,n).then((function(){l(t,r)})).catch((function(e){d("2",t,r,e)})));break;case b:e.res||(console.log("---- step : ",s," procedure name ",t),0==s?o.Z.setOrderDelivered(a,c,n).then((function(){u(t,r,n)})).catch((function(e){d("2",t,r,e)})):1==s&&o.Z.setWhoMakeDelivery(i,a,n).then((function(){l(t,r)})).catch((function(e){d("2",t,r,e)})));break;case UNDO_DELIVER_PROC_NAME:e.res||o.Z.undoDeliver(a,n).then((function(){var e=v.replace("procedure",t).replace("data",r);console.log(e)})).catch((function(e){var n=y.replace("procedure",t).replace("data",r);o.Z.saveProcedure("2",t,r),console.log(n),console.log(e)}));break;default:console.log("PROCEDURE UNKNOW")}})).catch((function(e){var n=y.replace("procedure",t).replace("data",r);o.Z.saveProcedure("2",t,r),console.log(n),console.log(e)}))}}},6583:(e,t,r)=>{"use strict";var n=r(5656),o=r(9958),a=r(7466),c=r(9341),i=r(9207),s=Math.min,l=[].lastIndexOf,d=!!l&&1/[1].lastIndexOf(1,-0)<0,u=c("lastIndexOf"),p=i("indexOf",{ACCESSORS:!0,1:0}),f=d||!u||!p;e.exports=f?function(e){if(d)return l.apply(this,arguments)||0;var t=n(this),r=a(t.length),c=r-1;for(arguments.length>1&&(c=s(c,o(arguments[1]))),c<0&&(c=r+c);c>=0;c--)if(c in t&&t[c]===e)return c||0;return-1}:l},9587:(e,t,r)=>{var n=r(111),o=r(7674);e.exports=function(e,t,r){var a,c;return o&&"function"==typeof(a=t.constructor)&&a!==r&&n(c=a.prototype)&&c!==r.prototype&&o(e,c),e}},2772:(e,t,r)=>{"use strict";var n=r(2109),o=r(1318).indexOf,a=r(9341),c=r(9207),i=[].indexOf,s=!!i&&1/[1].indexOf(1,-0)<0,l=a("indexOf"),d=c("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:s||!l||!d},{indexOf:function(e){return s?i.apply(this,arguments)||0:o(this,e,arguments.length>1?arguments[1]:void 0)}})},4986:(e,t,r)=>{var n=r(2109),o=r(6583);n({target:"Array",proto:!0,forced:o!==[].lastIndexOf},{lastIndexOf:o})},4603:(e,t,r)=>{var n=r(9781),o=r(7854),a=r(4705),c=r(9587),i=r(3070).f,s=r(8006).f,l=r(7850),d=r(7066),u=r(2999),p=r(1320),f=r(7293),m=r(9909).set,h=r(6340),_=r(5112)("match"),g=o.RegExp,b=g.prototype,v=/a/g,y=/a/g,E=new g(v)!==v,O=u.UNSUPPORTED_Y;if(n&&a("RegExp",!E||O||f((function(){return y[_]=!1,g(v)!=v||g(y)==y||"/a/i"!=g(v,"i")})))){for(var S=function(e,t){var r,n=this instanceof S,o=l(e),a=void 0===t;if(!n&&o&&e.constructor===S&&a)return e;E?o&&!a&&(e=e.source):e instanceof S&&(a&&(t=d.call(e)),e=e.source),O&&(r=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var i=c(E?new g(e,t):g(e,t),n?this:b,S);return O&&r&&m(i,{sticky:r}),i},R=function(e){e in S||i(S,e,{configurable:!0,get:function(){return g[e]},set:function(t){g[e]=t}})},A=s(g),w=0;A.length>w;)R(A[w++]);b.constructor=S,S.prototype=b,p(o,"RegExp",S)}h("RegExp")}}]);
>>>>>>> master
